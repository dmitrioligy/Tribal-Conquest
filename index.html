<script src="http://code.jquery.com/jquery-2.1.0.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script src="Game.js"></script>
<script src="Render.js"></script>
<script src="Unit.js"></script>
<script src="Move-Attack.js"></script>
<script src="http://d3lp1msu2r81bx.cloudfront.net/kjs/js/lib/kinetic-v5.0.1.min.js"></script>



<div id="warning">
	JavaScript is required to run this app.
</div>

<div id="searching_section">
	<div id="status"   >Connecting to Tribal Conquest ...</div>
	Gamer Tag:
	<input id="name" type="text"></input>
	<input id="find" type="button" value="Find Game" disabled="true"></input>
</div>

<div id="container"></div>
<script>
  // $(document) returns a jQuery object representing the whole document (page).
  // $(document).ready(fn) tells jQuery to call function 'fn' after the whole
  // document is loaded.
  var name = "";
  $(document).ready(function() {
    // Hide the warning section and show the login section.
    $('#warning').css('display', 'none');
    $('#searching_section').css('display', 'block');
    $('#game').css('display', 'none');
    
    // Initialize socket.io.
    // document.location.host returns the host of the current page.
    var socket = io.connect('http://' + document.location.host);

    // If a welcome message is received, it means the chat room is available.
    // The Log In button will be then enabled.
    socket.on
    (
    	'welcome',
    	function(message) 
    	{
    		$('#status').text(message);
    		$('#find').attr('disabled', false);
    	}
    );


    socket.on
    (
    	'searching',
    	function(message)
    	{
    		$('#status').text(message);
    		$('#find').attr('disabled', true);
    		$('#find').attr('visible', false);
    		document.getElementById('find').style.visibility = 'hidden';  
    	}
    );


    // Start Game Initialization
    var game, render;
    socket.on
    (
    	'start_game',
    	function(message) 
    	{
    		$('#searching_section').css('display', 'none');
    		game = new Game(socket);
    		game.Initialize(2);
    		render = new Render(game, socket);

    		// Initialize players to the game
    		for (var i = 0; i < message.allPlayers.length; i++)
    		{
    			game.Add_Player(message.allPlayers[i]);
    		}
    	}
    );


    socket.on
    (
    	'failed_find_game',
    	function() 
    	{
    		$('#status').text('Failed to find a game!');
    	}
    );


    // Listen for new player added
    socket.on
    (
    	'add_player',
    	function(new_player) 
    	{
    		// Add a player to clients game
           	game.Add_Player(new_player.name);
    	}
    );

    // Sync player move/attack
    socket.on
    (
    	'sync_client_action',
    	function(message) 
    	{
    		// Simulating the clicks on other clients 
           	render.synchronizeTurn(message.oldX, message.oldY, message.newX, message.newY);
    	}
    );


    socket.on
    (
    	'next_turn',
    	function()
    	{
    		game.Next_Turn();
    	}
    );



    $('#find').click
    (
    	function() 
	    {
	    	name = $('#name').val();
	    	if (name) 
	    	{
	    		name = name.trim();
	    		if (name.length > 0) 
	    		{
	    			socket.emit('find_game', { player_name: name });
	    		}
	    	}
		      // Clear the input field.
		}
	);

    // When Enter is pressed in the name field, it should be treated as clicking
    // on the Log In button.
    $('#name').keyup
    (
	    function(event) 
	    {
	    	if (event.keyCode == 13) 
	    	{
	    		$('#find').click();
	    	}
	    }
	);

	    
	});
</script>

